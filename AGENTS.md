# AGENTS.md — 開発エージェント行動規約

本ドキュメントは、本リポジトリにおいて
**人間・AI を問わず実装を行うすべてのエージェントが従うべき規約**を定義する。

このプロジェクトは「考えながら実装する」ことを極力避け、
**決定事項を文書に固定し、それに従って淡々と実装する**ことを重視する。

---

## 1. 基本原則

- 実装は **PLAN.md と TODO.md を唯一の進行指針**とする
- 行き当たりばったりの設計変更は禁止
- 不確実な点・判断が必要な点は「コード内で誤魔化さず」必ず文書に残す
- 「便利そう」「一般的だから」という理由で依存や機能を追加しない

---

## 2. 必須参照ドキュメント

### 2.1 PLAN.md
- プロジェクト全体の設計・スコープ・非スコープを定義する
- **設計判断に迷った場合は必ず PLAN.md を優先**
- 実装が PLAN.md と矛盾する場合：
  - 実装を止める
  - 判断を ADR として文書化する
  - PLAN.md を更新する（または更新しないと決める）

### 2.2 TODO.md
- 実装順序の唯一の正解
- **上から順に着手すること**
- TODO を飛ばして別項目を実装してはならない
- 各タスクは「完了条件」を満たしたときのみ完了扱いとする

---

## 3. 判断・決定の記録ルール

### 3.1 ADR（Architecture Decision Record）

以下に該当する **新しい決定**は必ず `docs/ADR.md` に記載すること：

- ライブラリ / クレートの選定・変更
- 大きなアルゴリズム方針の選択（例：探索方法、データ構造）
- パフォーマンス・メモリに関わる設計判断
- 将来拡張を制限・可能にする構造的決定

#### ADR 記載ルール
- 「なぜそうしたか」を必ず書く
- 代替案と、それを採用しなかった理由を書く
- 実装詳細ではなく **判断の根拠**を書く

---

### 3.2 MEMO（補足・途中経過）

以下のような内容は `docs/MEMO.md` に記載する：

- 調査途中の知見
- heapsnapshot フォーマットの観察結果
- 今は使わないが将来役立ちそうな情報
- 「今回は見送ったが気になる点」

※ MEMO は決定事項ではない。
※ ADR に昇格させるかどうか迷ったら MEMO に書く。

---

## 4. 実装時の禁止事項

- PLAN.md / TODO.md を無視した実装
- ドキュメントに残らない設計変更
- ネットワーク通信を行うコードの追加
- 巨大 JSON の一括デシリアライズ（明示的に禁止）
- 「あとで直す」前提の暫定実装

---

## 5. 実装時の必須行動

- 大きな処理（パース、探索など）にはコメントで意図を書く
- 不明点・仮定はコメントではなく **MEMO.md** に書く
- エラーメッセージは「次に何をすべきか」が分かる文言にする
- CLI の挙動は PLAN.md / TODO.md に記載された例と一致させる

---

## 6. AIエージェント向け追加規約

- 勝手にスコープを広げない
- 「一般的には〜」という理由で設計を変更しない
- 判断が必要な場合：
  1. 実装を止める
  2. ADR または MEMO に記載する
  3. 既存ドキュメントとの整合を確認する
- コードだけを書いて満足しない。**文書更新までが1タスク**

---

## 7. ゴールの再確認

このプロジェクトの成功条件は：

- 巨大 heapsnapshot を **OOMせず**
- DevTools では不可能だった
  - 構造を保った
  - 共有可能な
  - Markdown / JSON 出力
- を **ローカル完結のCLI**で実現すること

このゴールから外れる判断は、必ず文書で正当化されなければならない。

---

## 8. 最後に

> 「考えたことがコードに現れる前に、文書に現れているか？」

この問いに YES と言えない場合、その実装は規約違反である。
